<div class="pool-container">
    <h1 class="page-title">Pool Statistics</h1>
    <% if (pool) { %>

    <div class="home-sections">
        <!-- Pool Overview Hero Card -->
        <div class="home-section hero-card">
            <div class="hero-header">
                <div class="hero-title-section">
                    <h2>Pool Overview</h2>
                    <span class="live-indicator">
                        <span class="live-dot"></span>
                        <%= pool.workers %> workers connected
                    </span>
                </div>
            </div>
            <div class="hero-stats">
                <div class="hero-stat primary">
                    <div class="hero-stat-value"><%= formatHashrate(pool.hashrate) %></div>
                    <div class="hero-stat-label">Pool Hashrate</div>
                </div>
                <div class="hero-stat">
                    <div class="hero-stat-value"><%= pool.users %></div>
                    <div class="hero-stat-label">Users</div>
                </div>
                <div class="hero-stat">
                    <div class="hero-stat-value"><%= pool.workers %></div>
                    <div class="hero-stat-label">Workers</div>
                </div>
                <div class="hero-stat">
                    <div class="hero-stat-value"><%= pool.connections || 'N/A' %></div>
                    <div class="hero-stat-label">Connections</div>
                </div>
            </div>
            <div class="hero-details">
                <div class="hero-detail-row">
                    <div class="hero-detail">
                        <span class="detail-label">Best Difficulty</span>
                        <span class="detail-value highlight"><%= formatDifficulty(pool.bestDiff) %></span>
                    </div>
                    <div class="hero-detail">
                        <span class="detail-label">Shares/sec (1m)</span>
                        <span class="detail-value"><%= pool.sps1.toFixed(2) %></span>
                    </div>
                    <div class="hero-detail">
                        <span class="detail-label">Total Shares</span>
                        <span class="detail-value"><%= pool.shares.toLocaleString() %></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Network & Block Estimation Card -->
        <div class="home-section hero-card">
            <div class="hero-header">
                <div class="hero-title-section">
                    <h2>Network & Block Estimation</h2>
                </div>
            </div>
            <div class="hero-stats">
                <div class="hero-stat primary">
                    <div class="hero-stat-value" id="block-time-estimate">Calculating...</div>
                    <div class="hero-stat-label">Expected Block Time</div>
                </div>
                <div class="hero-stat">
                    <div class="hero-stat-value"><%= pool.blockHeight || 'N/A' %></div>
                    <div class="hero-stat-label">Next Block</div>
                </div>
                <div class="hero-stat">
                    <div class="hero-stat-value"><%= formatHashrate(networkHashrate) %></div>
                    <div class="hero-stat-label">Network Hashrate</div>
                </div>
                <div class="hero-stat">
                    <div class="hero-stat-value"><%= networkShare > 0 ? (networkShare >= 0.0001 ? networkShare.toFixed(6) + '%' : '< 0.0001%') : 'N/A' %></div>
                    <div class="hero-stat-label">Network Share</div>
                </div>
            </div>
            <div class="hero-details">
                <div class="hero-detail-row">
                    <div class="hero-detail">
                        <span class="detail-label">Network Difficulty</span>
                        <span class="detail-value"><%= formatDifficulty(pool.networkDiff) %></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Share Performance Card -->
        <div class="home-section fee-rates">
            <h3>Share Performance</h3>
            <div class="fee-grid">
                <div class="fee-item">
                    <span class="fee-label">Accepted Diff</span>
                    <span class="fee-value success"><%= formatDifficulty(pool.accepted) %></span>
                </div>
                <div class="fee-item">
                    <span class="fee-label">Rejected Diff</span>
                    <span class="fee-value"><%= formatDifficulty(pool.rejected) %></span>
                </div>
                <div class="fee-item">
                    <span class="fee-label">Reject Rate</span>
                    <span class="fee-value <%= pool.rejected > 0 ? 'warning' : 'success' %>"><%= pool.accepted > 0 ? ((pool.rejected / (pool.accepted + pool.rejected)) * 100).toFixed(2) + '%' : '0%' %></span>
                </div>
            </div>
            <h4 style="margin-top: 20px; margin-bottom: 10px; text-align: center;">Hashrate Averages</h4>
            <div class="fee-grid">
                <div class="fee-item">
                    <span class="fee-label">1m</span>
                    <span class="fee-value"><%= formatHashrate(pool.hashrate1m) %></span>
                </div>
                <div class="fee-item">
                    <span class="fee-label">5m</span>
                    <span class="fee-value"><%= formatHashrate(pool.hashrate5m) %></span>
                </div>
                <div class="fee-item">
                    <span class="fee-label">15m</span>
                    <span class="fee-value"><%= formatHashrate(pool.hashrate15m) %></span>
                </div>
                <div class="fee-item">
                    <span class="fee-label">1h</span>
                    <span class="fee-value"><%= formatHashrate(pool.hashrate1h) %></span>
                </div>
                <div class="fee-item">
                    <span class="fee-label">6h</span>
                    <span class="fee-value"><%= formatHashrate(pool.hashrate6h) %></span>
                </div>
                <div class="fee-item">
                    <span class="fee-label">24h</span>
                    <span class="fee-value"><%= formatHashrate(pool.hashrate1d) %></span>
                </div>
            </div>
        </div>

        <!-- Pool Status Card -->
        <div class="home-section fee-rates">
            <h3>Pool Status</h3>
            <div class="fee-grid">
                <div class="fee-item">
                    <span class="fee-label">Uptime</span>
                    <span class="fee-value"><%= pool.uptime > 0 ? timeAgo(Math.floor(Date.now()/1000) - pool.uptime).replace(' ago', '') : 'N/A' %></span>
                </div>
                <div class="fee-item">
                    <span class="fee-label">Started</span>
                    <span class="fee-value"><%= pool.startTime > 1577836800 ? timeAgo(pool.startTime) : 'N/A' %></span>
                </div>
                <div class="fee-item">
                    <span class="fee-label">Last Update</span>
                    <span class="fee-value"><%= pool.lastUpdate > 1577836800 ? timeAgo(pool.lastUpdate) : 'Just now' %></span>
                </div>
            </div>
        </div>

        <% if (minerTypes && minerTypes.length > 0) { %>
        <!-- Connected Miner Types -->
        <div class="home-section fee-rates">
            <h3>Connected Miner Types</h3>
            <div class="miner-types-grid">
                <% minerTypes.forEach(function(m) { %>
                <div class="miner-type-card">
                    <div class="miner-type-name"><%= m.name %></div>
                    <div class="miner-type-count"><%= m.count %></div>
                </div>
                <% }); %>
            </div>
        </div>
        <% } %>

        <!-- Pool Hashrate Chart -->
        <div class="home-section hashrate-section">
            <h3>Pool Hashrate</h3>
            <div class="chart-container">
                <% if (pool.hashrate1m > 0 || pool.hashrate5m > 0 || pool.hashrate1h > 0 || pool.hashrate1d > 0) { %>
                <canvas id="pool-hashrate-chart"></canvas>
                <% } else { %>
                <div class="no-chart-data">
                    <p>No hashrate data available yet.</p>
                    <p class="hint">Data will appear when miners are connected.</p>
                </div>
                <% } %>
            </div>
        </div>
    </div>

    <% } else { %>
    <div class="no-data">
        <p>Unable to load pool statistics.</p>
        <p>The pool daemon may not be running.</p>
    </div>
    <% } %>

    <div class="stats-actions">
        <a href="/" class="btn btn-secondary">Back to Home</a>
        <button class="btn btn-primary" onclick="location.reload()">Refresh</button>
    </div>
</div>

<script>
    <% if (pool) { %>
    document.addEventListener('DOMContentLoaded', function() {
        const poolHashrate = <%= pool.hashrate || 0 %>;
        const networkDiff = <%= pool.networkDiff || 0 %>;

        if (poolHashrate > 0 && networkDiff > 0) {
            const secondsPerBlock = (networkDiff * Math.pow(2, 32)) / poolHashrate;
            document.getElementById('block-time-estimate').textContent = formatTimeEstimate(secondsPerBlock);
        } else {
            document.getElementById('block-time-estimate').textContent = 'N/A';
        }

        <% if (pool.hashrate1m > 0 || pool.hashrate5m > 0 || pool.hashrate1h > 0 || pool.hashrate1d > 0) { %>
        if (typeof initHashrateChart === 'function') {
            initHashrateChart([
                { label: '7d', value: <%= pool.hashrate7d || 0 %> },
                { label: '24h', value: <%= pool.hashrate1d || 0 %> },
                { label: '6h', value: <%= pool.hashrate6h || 0 %> },
                { label: '1h', value: <%= pool.hashrate1h || 0 %> },
                { label: '15m', value: <%= pool.hashrate15m || 0 %> },
                { label: '5m', value: <%= pool.hashrate5m || 0 %> },
                { label: '1m', value: <%= pool.hashrate1m || 0 %> }
            ], 'pool-hashrate-chart');
        }
        <% } %>
    });

    function formatTimeEstimate(seconds) {
        if (seconds < 60) return Math.round(seconds) + ' seconds';
        if (seconds < 3600) return Math.round(seconds / 60) + ' minutes';
        if (seconds < 86400) return Math.round(seconds / 3600) + ' hours';
        if (seconds < 2592000) return Math.round(seconds / 86400) + ' days';
        if (seconds < 31536000) return Math.round(seconds / 2592000) + ' months';
        return Math.round(seconds / 31536000) + ' years';
    }
    <% } %>
</script>
